# QA Reference: Story 6.1 Extended Dataset Ingestion

## Purpose

Document the data cleaning and normalization rules introduced while ingesting the Palmer Penguins extended dataset (2021–2025). This note enables QA to validate transformations and understand the assumptions applied during import.

## Normalization Rules

- **Island aliases → canonical**: `Torgensen`, `Torgesen`, `Biscoe Island`, `Dream Island` → `Torgersen`, `Biscoe`, `Dream`
- **Diet coverage**: Only `fish`, `krill`, `squid`, `parental` are retained. Any unexpected diet values emit a normalization warning and are dropped to `null`.
- **Life stage coverage**: `adult`, `juvenile`, `chick` recognised. Unknown stages log a warning and become `null`.
- **Health metrics coverage**: `healthy`, `overweight`, `underweight` recognised. Other descriptors log a warning and become `null`.
- **Species canonicalisation**: Tokens outside `Adelie`, `Chinstrap`, `Gentoo` are discarded. Records missing either species or island after normalization are skipped.
- **Year guardrail**: Valid years limited to 2021–2025. Out-of-range years log a warning and coerce to 2025 for downstream visual consistency.

Warnings are surfaced once per unexpected value via `console.warn` (development only) and exposed through `getUnexpectedCategorySummary()` for automated validation.

## Null & Numeric Handling

- Measurements (`bill_length_mm`, `bill_depth_mm`, `flipper_length_mm`, `body_mass_g`) convert `0`, `null`, `undefined`, or `NaN` to `null` before storage.
- Sex values normalise `male`/`m` and `female`/`f`; other tokens clear to `null`.
- Extended categorical fields default to `null` when blank, whitespace, or unrecognised.

## Dataset Spot-Checks

- Unique diets discovered: `fish`, `krill`, `squid`, `parental`.
- Unique life stages: `adult`, `juvenile`, `chick`.
- Unique health metrics: `healthy`, `overweight`, `underweight`.
- Year range confirmed: 2021–2025 inclusive.
- Alias count observed: 514 records labelled `Torgensen` now surface as `Torgersen` in UI filters and URLs.

## QA Follow-up Suggestions

1. Exercise `getUnexpectedCategorySummary()` inside unit tests when introducing new dataset revisions to ensure new categories are either mapped or explicitly accepted.
2. Validate ingestion warnings remain empty during CI to catch upstream CSV drift.
3. Re-run scatter/histogram/box plot snapshots with the 2025 cohort to confirm chart integrity and axis labelling across the extended range.

## Performance Snapshot (2025-10-18)

- `vitest bench tests/performance/ingestion.bench.ts`
  - `transformPenguinData`: **0.913 ms** mean execution (≈1,095 ops/sec across 548 samples)
  - Max observed run: 6.00 ms (with cached dataset; includes allocator overhead only)
- Interpretation: ingestion transform scales comfortably for the 3,430-record dataset with ample headroom for minor growth.
